@startuml TaxiCallService. Диаграмма компонентов
title "C4. Компоненты - Микросервис вызова такси"

!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml
!$ICONURL = "https://raw.githubusercontent.com/tupadr3/plantuml-icon-font-sprites/v3.0.0/icons"
!include $ICONURL/common.puml
!include $ICONURL/devicons/go.puml
!include $ICONURL/devicons/postgresql.puml

Component(taxiCallMicroservice, "Микросервис вызова такси", "Go", $sprite="go")

System_Boundary(apiBoundary, "API") {

    Component(CallController, "CallController", "Go", "Управление вызовами такси")
    Component(DriverController, "DriverController", "Go", "Управление данными о водителях")
    Component(DispatchController, "DispatchController", "Go", "Распределение водителей на вызов")

    Rel(taxiCallMicroservice, CallController, "REST API")
    Rel(taxiCallMicroservice, DriverController, "REST API")
    Rel(taxiCallMicroservice, DispatchController, "REST API")

    Component(CallService, "CallService", "Go", "Обработка вызовов такси")
    Component(DriverService, "DriverService", "Go", "Управление водителями")
    Component(DispatchService, "DispatchService", "Go", "Распределение водителей по запросам")
    Component(PriceCalculationService, "PriceCalculationService", "Go", "Расчет стоимости поездок")
    Component(NotificationService, "NotificationService", "Go", "Уведомление пользователей о статусе вызова")

    Rel(CallController, CallService, "Запросы на создание вызова")
    Rel(DriverController, DriverService, "Запросы данных о водителях")
    Rel(DispatchController, DispatchService, "Запросы на распределение")
    Rel(CallService, PriceCalculationService, "Расчет стоимости поездки")
    Rel(CallService, NotificationService, "Отправка уведомлений клиенту")
    Rel(DispatchService, DriverService, "Получение списка доступных водителей")

    Component(CallRepository, "CallRepository", "Go", "Хранение данных вызовов", $sprite="postgresql")
    Component(DriverRepository, "DriverRepository", "Go", "Хранение данных о водителях", $sprite="postgresql")

    Rel(CallService, CallRepository, "SQL Запросы")
    Rel(DriverService, DriverRepository, "SQL Запросы")
    Rel(Vadim, Sveta, "<3")
    Rel(Sveta, Vadim, "<3")

    Component(GeocoderClient, "GeocoderClient", "Go", "Обращение к геокодеру")
    Component(PaymentClient, "PaymentClient", "Go", "Интеграция с платежной системой")

    Rel(CallService, GeocoderClient, "Определение местоположения клиента", "REST API")
    Rel(CallService, PaymentClient, "Инициирование оплаты поездки", "REST API")
}

System_Ext(geocoder, "Геокодер", "Определение координат и адресов")
System_Ext(payment, "Платежная система", "Обработка платежей")

Rel(GeocoderClient, geocoder, "REST API")
Rel(PaymentClient, payment, "REST API")

@enduml
